[project]
name = "cauldron-uv-workspace"
version = "0.0.1"
description = "Add your description here"
readme = "docs/README.md"
requires-python = ">=3.13"
dependencies = [
    "cauldron",
    "project-manager",
    "cauldronlib-generic",
    "cauldronlib-cli",
    "cauldron-test-dependencies",
    "cauldron-incubator",
]

[tool.uv.workspace]
members = [
    "framework",
    "libs/*",
    "samples/*",
    "test-dependencies",
    "incubator",
]

[tool.uv.sources]
project-manager = { workspace = true }
cauldron = { workspace = true }
cauldronlib-generic = { workspace = true }
cauldronlib-cli = { workspace = true }
cauldron-test-dependencies = { workspace = true }
cauldron-incubator = {workspace=true}

[dependency-groups]
dev = [
    "cauldron-test-dependencies",
    "pre-commit>=4.3.0",
]
docs = [
    "mkdocs>=1.6.1",
    "mkdocs-material>=9.6.18",
]

[tool.ruff]
line-length = 88

[tool.ruff.format]
docstring-code-format = true
line-ending = "lf"

[tool.ruff.lint]
extend-select = [
    "A",
    "B",
    "Q",
    "C4",
    "DTZ",
    "FIX",
    "ISC",
    "ICN",
    "LOG",
    "T",
    "PT",
    "SLF",
    "SIM",
    "TID",
    "ARG",
    "PTH",
    "I",
    "C90",
    "N",
    "UP",
    "FURB",
    "RUF",
    "TRY",
    "TC",
    "PERF",
    "PL",
    "UP",
    ]
extend-ignore = [
    "A002",
    "TRY003", # disagree about error message length
    "N818", # disagree about error naming
    "PLC0414",
    "RUF009",
]

[tool.ruff.lint.per-file-ignores]
"**/tests/**" = [
    "ARG001", # pytest fixtures may cause unused function args to be valid
    "PLR2004" # magic values are reasonable in tests
    ]

[tool.pytest.ini_options]
addopts = "--import-mode=importlib --cov-report=html --cov-report=term --cov=. --cov-fail-under=90 --cov-context=test --cov-branch --html=testreport/index.html --markdown-docs"
python_files = [
    "test_*.py",
    "*_test.py",
    "feat_*.py",
]
norecursedirs = ".venv incubator/src/cauldron_incubator/db/migrations"

[tool.coverage.run]
concurrency = ["thread", "greenlet"]

[tool.coverage.report]
exclude_also = [
    'def __repr__',
    'if self.debug:',
    'if settings.DEBUG',
    'raise AssertionError',
    'raise NotImplementedError',
    'if 0:',
    'if __name__ == .__main__.:',
    'if TYPE_CHECKING:',
    'class .*\bProtocol\):',
    '@(abc\.)?abstractmethod',
    'assert False',
    'pytest.fail',
]

[tool.ruff.lint.flake8-type-checking]
runtime-evaluated-base-classes = ["pydantic.BaseModel", "sqlalchemy.orm.DeclarativeBase", "cauldron.db.base.Base"]

[tool.ruff.lint.pydocstyle]
convention = "google"
